# 物流トラブル管理システム 開発計画

## プロジェクト概要
- **プロジェクト名**: 物流トラブル管理システム
- **技術スタック**: Next.js 15.4.6 (フロントエンド) + ASP.NET Core 8.0 LTS (バックエンド) + SQL Server 2022
- **開発環境**: Windows 11 + Docker (開発用DB)
- **開始日**: 2025-08-12

## 開発フェーズ

### 🔴 フェーズ1: 環境構築と基盤整備 (優先度: 高)
- [x] 1.1 機能仕様書の作成
  - [x] 既存フロントエンドコードの分析
  - [x] データモデルの定義
  - [x] API仕様の設計
  - [x] 画面仕様の整理
  - [x] 見積時間: 4時間

- [x] 1.2 プロジェクト構造の整理
  - [x] 既存のNext.jsプロジェクトをfrontend/配下に移動
  - [x] backend/ディレクトリの作成
  - [x] database/ディレクトリの作成
  - [x] deployment/ディレクトリの作成
  - [x] docs/ディレクトリの作成
  - [x] 全体ディレクトリ構造の整備
  - [x] 見積時間: 2時間

- [x] 1.3 開発用データベース環境の構築
  - [x] Docker Composeファイルの作成 (SQL Server 2022)
  - [x] データベース初期化スクリプトの作成
  - [x] サンプルデータの作成
  - [x] 接続設定の確認
  - [x] 見積時間: 3時間

- [x] 1.4 バックエンドプロジェクトの作成
  - [x] ASP.NET Core 8.0 LTS ソリューションの作成
  - [x] 各レイヤープロジェクトの作成 (API, Core, Infrastructure, Domain, Tests)
  - [x] 基本的なNuGetパッケージの追加
  - [x] 基本的な設定ファイルの作成
  - [x] 見積時間: 4時間

### 🟡 フェーズ2: ドメインモデルとデータベース設計 (優先度: 高)
- [x] 2.1 ドメインモデルの実装
  - [x] BaseEntityクラスの作成
  - [x] Incidentエンティティの実装
  - [x] Userエンティティの実装（簡易版）
  - [x] Attachmentエンティティの実装
  - [x] AuditLogエンティティの実装（簡易版）
  - [x] 列挙型の定義 (IncidentStatus, Priority, UserRole等)
  - [x] 値オブジェクトの実装 (Email, PhoneNumber等)
  - [x] 見積時間: 6時間

- [x] 2.2 Entity Framework Core設定
  - [x] ApplicationDbContextの実装
  - [x] エンティティ設定クラスの作成
  - [x] 初期マイグレーションの作成（ベースライン）
  - [x] データベース接続のテスト（マイグレーション適用）
  - [x] サンプルデータの投入
  - [x] 見積時間: 4時間

- [x] 2.3 リポジトリパターンの実装
  - [x] IRepository<T>インターフェースの作成
  - [x] 各エンティティのリポジトリ実装
  - [x] Unit of Workパターンの実装
  - [x] DIコンテナへの登録
  - [x] 見積時間: 5時間

### 🟡 フェーズ3: バックエンドAPI開発 (優先度: 高)
- [x] 3.1 トラブル管理API（モック版）
  - [x] IncidentsControllerの実装
  - [x] CRUD操作の実装（GET, POST, PUT, DELETE）
  - [x] 検索・フィルタリング機能
  - [x] ページネーション機能
  - [x] ソート機能
  - [x] DTOクラスの作成
  - [x] バリデーションの実装
  - [x] 見積時間: 8時間

- [x] 3.8 バックエンド起動問題の解決
  - [x] Entity Framework Coreマイグレーション問題の解決
  - [x] データベース初期化処理の改善
  - [x] エラーハンドリングの強化
  - [x] 開発環境での柔軟な起動処理
  - [x] 見積時間: 2時間

- [x] 3.9 フロントエンド・バックエンド連携問題の解決
  - [x] PascalCase/camelCase型定義の不一致問題を解決
  - [x] 統計カードの表示問題を解決
  - [x] インシデント一覧の表示問題を解決
  - [x] 日本語文字の処理問題を解決
  - [x] 環境変数設定の最適化
  - [x] 見積時間: 3時間

- [x] 3.10 物流特化システムへの対応
  - [x] 物流特化型定義の追加（TroubleType, DamageType, Warehouse, ShippingCompany, EffectivenessStatus）
  - [x] バックエンドエンティティ・DTO・バリデーションの更新
  - [x] データベースマイグレーションの実行
  - [x] フロントエンド型定義の更新
  - [x] 物流トラブル登録フォームの再設計
  - [x] 物流トラブル一覧の表示項目を提供サイトに合わせて修正

- [x] 3.11 テストコードの非公開セッターアクセス問題の解決
  - [x] IncidentRepositoryTestsのGetOverdueIncidentsAsync_ShouldReturnOverdueIncidentsテストを修正
  - [x] リフレクションを使用した非公開セッターへのアクセス実装
  - [x] BindingFlagsの適切な設定（Instance | Public | NonPublic）
  - [x] GetSetMethod(true)を使用したセッターの取得とInvoke実行
  - [x] テストの正常動作確認
  - [x] 見積時間: 1時間

- [x] 3.11 ダークモード機能の削除
  - [x] globals.cssからダークモード関連のCSS変数を削除
  - [x] ダークモード関連のタブスタイルを削除
  - [x] @custom-variant darkの削除
  - [x] 見積時間: 0.5時間

- [x] 3.11 UI/UX問題の解決
  - [x] モーダルダイアログとドロップダウンリストの背景色透過問題を解決
  - [x] Tailwind CSS設定にCSS変数を追加
  - [x] CSS変数の値をHSL形式に統一
  - [x] ボタンの背景色を適切な青系に調整
  - [x] 境界線の色を適切な濃さに調整
  - [x] 見積時間: 2時間

- [x] 3.11 データベーススクリプトの更新
  - [x] 現在のDB状態に合わせたテーブル作成スクリプトの更新
  - [x] 拡張フィールドに対応したインデックス作成スクリプトの更新
  - [x] 物流特化データを含むサンプルデータ作成スクリプトの更新
  - [x] 更新されたスクリプトの実行手順と説明書の作成
  - [x] 見積時間: 3時間
  - [x] 見積時間: 6時間

- [x] 3.11 提供サイト準拠の物流トラブル登録フォーム実装
  - [x] 新規フィールドの追加（発生経緯、出荷総数、不良品数、発生日、発生場所、概要、原因、再発防止策、有効性評価）
  - [x] 2列レイアウトの実装（左列：発生経緯・トラブル詳細、右列：原因分析・再発防止策・有効性評価）
  - [x] バックエンドDTO・エンティティ・バリデーションの更新
  - [x] データベースマイグレーションの実行
  - [x] フロントエンド型定義・フォームコンポーネントの更新
  - [x] 動作確認とテスト
  - [x] 見積時間: 8時間

- [x] 3.12 システム起動時のデータ取得問題の解決
  - [x] フロントエンドメインページのコンポーネント分割（Dashboard, IncidentManagement）
  - [x] 型定義のcamelCase統一（StatisticsSummaryDto, IncidentDto, PagedResultDto等）
  - [x] プロパティ名の統一（totalIncidents, openCount, items, totalPages等）
  - [x] 統計カードの正常表示確認（総インシデント: 11, 未解決: 8, 解決済み: 2）
  - [x] インシデント一覧の正常表示確認（10件のインシデントが表示）
  - [x] 統計グラフの正常表示確認
  - [x] 見積時間: 4時間

- [x] 3.13 統計グラフ描画問題の解決
  - [x] グラフデータのプロパティ名修正（Items→items, Label→label, Value→value等）
  - [x] 型定義のcamelCase統一（ChartDataDto, PieChartDataDto, PieChartItemDto等）
  - [x] 損傷種類グラフの正常表示確認
  - [x] トラブル種類グラフの正常表示確認
  - [x] 月間発生件数グラフの正常表示確認
  - [x] 見積時間: 3時間

- [x] 3.14 シードデータの不足情報補完
  - [x] 画像の表示内容に合致するテストデータの作成
  - [x] トラブル種類を10種類に拡張（商品トラブル、配送トラブル、システムトラブル、設備トラブル、品質トラブル、物流トラブル、管理トラブル、安全トラブル、環境トラブル、その他のトラブル）
  - [x] 損傷の種類に"該当なし"の値を追加
  - [x] 出荷元倉庫に"該当なし"の値を追加
  - [x] 運送会社名に"該当なし"の値を追加
  - [x] フロントエンドの型定義とヘルパー関数の更新
  - [x] 見積時間: 4時間

### 🔴 フェーズ3.15: マスタ管理機能拡張 (優先度: 高)
- [x] 3.15.1 データベース設計・作成
  - [x] マスタテーブルの作成（TroubleTypes, DamageTypes, Warehouses, ShippingCompanies）
  - [x] 既存Enum値のマスタデータ投入
  - [x] インデックス・制約の設定
  - [x] データベースマイグレーションの作成
  - [x] 見積時間: 6時間

- [x] 3.15.2 バックエンド実装
  - [x] マスタデータエンティティの作成（TroubleType, DamageType, Warehouse, ShippingCompany）
  - [x] マスタデータリポジトリの実装
  - [x] マスタ管理APIの実装（CRUD操作、一覧取得、有効/無効化）
  - [x] Incidentエンティティの更新（EnumからマスタIDへの変更）
  - [x] DTOクラスの更新（マスタ情報を含む表示用DTO）
  - [x] バリデーションの更新
  - [x] 見積時間: 12時間

- [x] 3.15.3 フロントエンド実装
  - [x] 型定義の更新（マスタデータ対応）
  - [x] マスタ管理画面の実装（一覧、新規作成、編集、削除）
  - [x] インシデント登録・編集フォームの更新（マスタ選択対応）
  - [x] 一覧表示の更新（マスタ名表示）
  - [x] 共通コンポーネントの作成（マスタ選択、カラーピッカー等）
  - [x] 見積時間: 16時間

- [x] 3.15.4 データ移行・テスト
  - [x] 動作確認・テスト（各マスタ管理画面）
  - [x] パフォーマンステスト（マスタデータ取得、結合クエリ）
  - [x] 既存機能への影響確認
  - [x] 見積時間: 8時間

### 🔴 フェーズ3.16: ダークモード機能無効化 (優先度: 高)
- [x] 3.16.1 マスタ管理機能のダークモード無効化
  - [x] マスタ管理ページ（/master/page.tsx）のダークモードクラス削除
  - [x] トラブル種類管理コンポーネントのダークモードクラス削除
  - [x] 損傷種類管理コンポーネントのダークモードクラス削除
  - [x] 出荷元倉庫管理コンポーネントのダークモードクラス削除
  - [x] 運送会社管理コンポーネントのダークモードクラス削除
  - [x] 共通コンポーネント（MasterSelect、ColorPicker）のダークモードクラス削除
  - [x] ビルド確認と動作テスト
  - [x] 見積時間: 2時間

### 2025-09-02: ログイン機能実装計画策定
- [x] ログイン機能実装の変更概要仕様書の作成
  - [x] マインドマップに基づく機能要件の整理
  - [x] 3つのユーザーロール（事務員、インシデント管理者、倉庫担当）の定義
  - [x] ロール別ダッシュボード表示の仕様策定
  - [x] JWT認証・ロールベースアクセス制御の設計
- [x] 実装計画の策定
  - [x] フェーズ3.29としてログイン機能実装を追加
  - [x] 6段階の実装ステップを定義
  - [x] 見積時間の算出（合計36時間）
  - [x] 優先度を高に設定（セキュリティ強化のため）

### 2025-08-29: マスタ管理機能拡張計画策定
- [x] マスタ管理機能拡張仕様書の確認
  - [x] 4項目のEnumからマスタテーブルへの変更計画確認
  - [x] 個別テーブル設計の妥当性確認
  - [x] 段階的移行計画の確認
  - [x] レイアウト崩れの可能性分析（問題なしと判断）
- [x] 実装計画の策定
  - [x] フェーズ3.15としてマスタ管理機能拡張を追加
  - [x] 4段階の実装ステップを定義
  - [x] 見積時間の算出（合計42時間）
  - [x] 優先度を高に設定（システム拡張性向上のため）

- [x] 3.2 統計API（モック版）
  - [x] StatisticsControllerの実装
  - [x] ダッシュボード統計API（サマリー）
  - [x] グラフデータAPI
  - [x] PPM計算API
  - [x] 見積時間: 4時間

- [x] 3.3 ファイル管理API（モック版）
  - [x] AttachmentsControllerの実装
  - [x] ファイルアップロード機能
  - [x] ファイルダウンロード機能
  - [x] ファイル一覧取得機能
  - [x] 見積時間: 4時間

- [x] 3.4 効果測定API（モック版）
  - [x] EffectivenessControllerの実装
  - [x] 効果測定登録機能
  - [x] 効果測定一覧取得機能
  - [x] 見積時間: 3時間

- [x] 3.5 バリデーションとエラーハンドリング
  - [x] FluentValidationの実装
  - [x] グローバルエラーハンドリング
  - [x] カスタム例外クラスの実装（ミドルウェア内で整形）
  - [x] 見積時間: 4時間

### 🔴 フェーズ3.29: ログイン機能実装 (優先度: 高)
- [ ] 3.29.1 データベース設計・テーブル作成
  - [ ] Usersテーブルの拡張（PasswordHash、LastLoginAt、RefreshToken等）
  - [ ] Rolesテーブルの新規作成
  - [ ] 既存RoleフィールドをRolesテーブルの外部キーとして活用
  - [ ] 既存データの移行処理
  - [ ] 見積時間: 2-3日（シンプルな構成により短縮）

- [ ] 3.29.2 認証・認可基盤の実装
  - [ ] JWTサービスの実装
  - [ ] パスワードハッシュ化サービスの実装
  - [ ] 認証・認可ミドルウェアの実装
  - [ ] 認証・認可フィルターの実装
  - [ ] 見積時間: 2-3日

- [ ] 3.29.3 バックエンド認証システム
  - [ ] AuthControllerの実装（ログイン、ログアウト、トークンリフレッシュ）
  - [ ] ユーザー管理APIの実装
  - [ ] ロール管理APIの実装
  - [ ] パスワード管理APIの実装
  - [ ] 見積時間: 3-4日

- [ ] 3.29.4 フロントエンド認証UI
  - [ ] ログイン画面の実装
  - [ ] 認証コンテキストの実装
  - [ ] ルート保護の実装
  - [ ] パスワード管理画面の実装
  - [ ] 見積時間: 2-3日

- [ ] 3.29.5 ロール別ダッシュボード
  - [ ] ロール別表示ロジックの実装
  - [ ] ダッシュボードコンポーネントの更新
  - [ ] 権限ベースUI制御の実装
  - [ ] ナビゲーションメニューの更新
  - [ ] 見積時間: 2-3日

- [ ] 3.29.6 テスト・品質保証
  - [ ] 認証機能の単体テスト
  - [ ] 認可機能の統合テスト
  - [ ] セキュリティテスト
  - [ ] E2Eテスト
  - [ ] 見積時間: 2-3日

**総見積時間: 11-16日（シンプルな構成により、当初の見積もりより短縮）**

### 🟢 フェーズ3.5: 認証・認可システム (優先度: 低)
- [x] 3.6 認証・認可システム
  - [x] JWT認証の実装
  - [x] AuthControllerの作成
  - [x] ユーザー登録・ログイン機能
  - [x] 権限管理機能
  - [x] テーブル仕様書の作成
  - [x] ER図の作成
  - [x] API仕様書の作成
  - [x] 見積時間: 8時間

- [x] 3.7 ユーザー管理API
  - [x] UsersControllerの実装
  - [x] ユーザー情報管理機能
  - [x] 権限管理機能
  - [x] 見積時間: 6時間

### 🟡 フェーズ4: フロントエンド開発 (優先度: 中)
- [x] 4.1 APIクライアントの実装
  - [x] API呼び出し用のサービス作成
  - [x] エラーハンドリング
  - [x] レスポンス型定義
  - [x] 見積時間: 4時間

- [x] 4.2 トラブル管理画面の実装
  - [x] トラブル一覧画面（既存の改良）
  - [x] トラブル詳細画面
  - [x] トラブル作成・編集画面（既存の改良）
  - [x] 検索・フィルタリング機能（既存の改良）
  - [x] ページネーション機能
  - [x] 見積時間: 8時間

- [x] 4.3 ダッシュボードの実装
  - [x] 統計情報の表示（既存の改良）
  - [x] グラフ・チャートの実装（既存の改良）
  - [x] フィルタ機能（既存の改良）
  - [x] 見積時間: 4時間

- [x] 4.4 ファイル管理機能の実装
  - [x] ファイルアップロード機能
  - [x] ファイル表示機能
  - [x] ファイルダウンロード機能
  - [x] 見積時間: 4時間

- [x] 4.5 効果測定機能の実装
  - [x] 効果測定登録画面
  - [x] 効果測定一覧画面
  - [x] 効果測定詳細画面
  - [x] 見積時間: 3時間

### 🟡 フェーズ4.5: UI/UXデザイン改善 (優先度: 中)
- [x] 4.7 提供サイトデザインへの準拠
  - [x] カラーパレットの統一（物流システム専用カラーの定義）
  - [x] ヘッダーの調整（タイトル変更、ボタン色変更）
  - [x] ダッシュボードの調整（統計カードの色分け、円グラフのカラーパレット）
  - [x] 一覧セクションの改善（検索バー、CSV出力、テーブル調整）
  - [x] UI要素の調整（ボタン配置、カラーパレット、スペーシング）
  - [x] 統計グラフのタブカラー改善（選択状態の視認性向上）
  - [x] タブ背景色の修正（CSS変数の直接適用）
  - [x] 月間発生件数グラフのレイアウト改善（レスポンシブ対応）
  - [x] 統計グラフの初期表示変更（当年度・当月表示）
  - [x] 動作確認とテスト
  - [x] 見積時間: 6時間

### 🟢 フェーズ4.6: 認証機能 (優先度: 低)
- [x] 4.6 認証画面の実装
  - [x] ログイン画面
  - [x] ユーザー登録画面
  - [x] パスワードリセット画面
  - [x] 見積時間: 8時間

### 🟢 フェーズ5: テストと品質保証 (優先度: 中)
- [x] 5.1 単体テスト
  - [x] ドメインエンティティのテスト
  - [x] 値オブジェクトのテスト
  - [x] バリデーションのテスト
  - [x] リポジトリ層のテスト
  - [x] 見積時間: 6時間

- [x] 5.2 統合テスト
  - [x] APIコントローラーのテスト（データベースプロバイダー競合のため一時的にスキップ）
  - [x] データベース統合テスト
  - [x] 見積時間: 4時間

- [x] 5.3 E2Eテスト
  - [x] ツール選定（MCP Playwright を使用）
  - [x] E2E環境準備
    - [x] テスト用ベースURL・環境変数の定義（フロント: http://host.docker.internal:3000, API: http://localhost:5169）
    - [x] テストデータ方針の決定（API経由で作成）
  - [x] 初期セットアップ
    - [x] MCP Playwright の利用開始
    - [x] フロントエンド・バックエンドの起動確認
  - [x] スモークテスト
    - [x] ルートアクセスで主要画面の描画確認（ダッシュボード、トラブル管理、ファイル管理、効果測定）
    - [x] ナビゲーション機能の動作確認
  - [x] シナリオテスト: トラブル管理フロー
    - [x] インシデント一覧の表示・検索（API接続成功、データ表示可能）
    - [x] インシデント新規作成フォームの動作確認（英語データで作成成功、日本語データでエラー発生）
  - [x] シナリオテスト: ダッシュボード
    - [x] 統計サマリーの表示（年指定の切替含む、API接続成功）
    - [x] グラフ領域のレンダリング確認（ダメージ種別・トラブル種別・月次件数、データ表示可能）
  - [x] シナリオテスト: ファイル管理
    - [x] ファイル一覧表示（API接続成功）
  - [x] シナリオテスト: 効果測定
    - [x] 効果測定一覧表示（API接続成功）
  - [x] 安定化
    - [x] API接続エラーの解決（Docker環境での接続問題解決済み）
    - [x] 列挙型のJSON変換設定追加（JsonStringEnumConverter）
    - [x] テストデータの準備（シードデータで動作確認済み）
    - [x] 統計・分析画面の実装（React 19互換性対応済み）
    - [x] 設定画面の実装（React 19互換性対応済み）
    - [x] 日本語文字のJSON処理（フロントエンドでは正常に動作、curlではエラー）
    - [x] 日本語文字の処理問題の完全解決（フロントエンド・バックエンド間の日本語データ送受信が正常に動作することを確認）
    - [x] グラフ表示問題の解決（PascalCase/camelCase型定義の不一致問題を解決、統計グラフが正常に表示されることを確認）
    - [x] インシデント編集フォームのcontrolled/uncontrolled inputエラー解決（フォーム初期化とプロパティ名の統一、ダイアログ状態管理の改善）
    - [x] システム起動時のデータ取得問題の完全解決（統計カード、インシデント一覧、統計グラフが正常に表示されることを確認）
    - [x] 統計グラフ描画問題の完全解決（損傷種類、トラブル種類、月間発生件数のグラフが正常に表示されることを確認）
  - [x] 見積時間: 6時間

- [ ] 5.4 パフォーマンステスト
  - [ ] API応答時間の測定
  - [ ] データベースクエリの最適化
  - [ ] 見積時間: 2時間

### ⚪ フェーズ6: デプロイメントと運用準備 (優先度: 低)
- [ ] 6.1 開発環境の最適化
  - [ ] Docker環境の最適化
  - [ ] 開発用データベースの最適化
  - [ ] ログ設定の改善
  - [ ] 見積時間: 3時間

- [ ] 6.2 監視・ログ設定
  - [ ] Serilog設定
  - [ ] ヘルスチェック実装
  - [ ] 基本的な監視設定
  - [ ] 見積時間: 2時間

- [ ] 6.3 ドキュメント整備
  - [ ] APIドキュメントの作成（Swagger）
  - [ ] 開発者向けマニュアルの作成
  - [ ] 見積時間: 3時間

### ⚪ フェーズ7: 本番環境準備 (優先度: 低)
- [ ] 7.1 本番環境設定
  - [ ] IIS設定の準備
  - [ ] 本番データベース設定
  - [ ] 環境変数の設定
  - [ ] 見積時間: 4時間

- [ ] 7.2 本番監視設定
  - [ ] Application Insights設定
  - [ ] 本番ログ設定
  - [ ] アラート設定
  - [ ] 見積時間: 3時間

- [ ] 7.3 運用ドキュメント整備
  - [ ] ユーザーマニュアルの作成
  - [ ] 運用マニュアルの作成
  - [ ] 障害対応マニュアルの作成
  - [ ] 見積時間: 6時間

## 技術的制約と注意事項

### 技術スタック制約
- **ASP.NET Core**: 8.0 LTS (バージョン変更禁止)
- **Next.js**: 15.4.6 (バージョン変更禁止)
- **React**: 19.1.0 (バージョン変更禁止)
- **SQL Server**: 2022 (開発用はDocker可)

### 開発環境制約
- **OS**: Windows 11
- **IDE**: Visual Studio 2022 / Visual Studio Code
- **データベース**: Docker上でSQL Server 2022

### アーキテクチャ制約
- **Clean Architecture**: 4層構成の厳守
- **Repository Pattern**: データアクセス層での使用
- **Unit of Work Pattern**: トランザクション管理
- **Dependency Injection**: 疎結合設計

### モック開発の優先事項
- **認証機能**: 後回し（フェーズ3.5以降）
- **既存フロントエンド**: 最大限活用
- **サンプルデータ**: 豊富に準備
- **基本機能**: 完全実装優先

## リスク管理

### 技術的リスク
- [ ] SQL Server Docker環境での接続問題
- [ ] ASP.NET Core 8.0 LTSの互換性問題
- [ ] Next.js 15.4.6の新機能による問題
- [ ] 既存フロントエンドとの統合問題

### 対応策
- [ ] 早期にDocker環境での動作確認
- [ ] 段階的な機能実装とテスト
- [ ] 既存のNext.jsプロジェクトとの統合テスト
- [ ] モックデータでの動作確認優先

## 進捗管理

### 週次レビュー項目
- [ ] 完了タスクの確認
- [ ] 未完了タスクの再評価
- [ ] 新規リスクの特定
- [ ] 次週の優先タスク決定

### マイルストーン
- **Week 1**: 環境構築完了（フェーズ1）
- **Week 2**: ドメインモデル実装完了（フェーズ2）
- **Week 3**: バックエンドAPI基本機能完了（フェーズ3）
- **Week 4**: フロントエンド基本機能完了（フェーズ4）
- **Week 5**: UI/UXデザイン改善完了（フェーズ4.5）
- **Week 6**: テスト完了（フェーズ5）
- **Week 7**: 開発環境最適化完了（フェーズ6）
- **Week 8**: 本番環境準備完了（フェーズ7）

## 品質基準

### コード品質
- [ ] SonarQube分析での品質ゲート通過
- [ ] コードカバレッジ80%以上
- [ ] 静的解析エラー0件

### パフォーマンス
- [ ] API応答時間500ms以内
- [ ] ページ読み込み時間2秒以内
- [ ] データベースクエリ100ms以内

### セキュリティ
- [ ] OWASP Top 10対策
- [ ] SQL Injection対策
- [ ] XSS対策
- [ ] CSRF対策

---

**最終更新**: 2025-08-25
**作成者**: 開発チーム

## 最近の修正履歴

### 2025-09-02: ログイン機能実装計画策定・設計簡素化
- **変更概要仕様書の作成**
  - ログイン機能実装_変更概要仕様書.mdの新規作成
  - 機能要件、技術仕様、実装計画の詳細化
  - セキュリティ考慮事項、非機能要件、リスク管理の策定
- **設計の簡素化**
  - UserRolesテーブルの削除（シンプルな構成への変更）
  - 既存RoleフィールドをRolesテーブルの外部キーとして活用
  - 実装時間の短縮（11-16日）
- **todo.mdの更新**
  - フェーズ3.29: ログイン機能実装の追加
  - 各フェーズの見積時間調整
  - シンプルな構成による効率化の反映

### 2025-08-29 3.15.3 フロントエンド実装 完了

#### インシデント管理UI更新
- **インシデント一覧表示の更新**
  - マスタデータ対応の型定義（Incident、IncidentSearchDto、CreateIncidentDto、UpdateIncidentDto）を追加
  - インシデント一覧コンポーネント（incident-list.tsx）を新しいマスタデータ対応に更新
  - トラブル種類の表示でマスタデータの色を使用するように変更
  - ソートキーを新しいマスタIDフィールド（troubleTypeId、damageTypeId、warehouseId、shippingCompanyId）に更新

- **インシデント詳細表示の更新**
  - インシデント詳細コンポーネント（incident-detail.tsx）にマスタ情報表示セクションを追加
  - トラブル種類の色表示、損傷の種類、出荷元倉庫、運送会社名の表示を追加

- **インシデント検索機能の更新**
  - インシデント検索コンポーネント（incident-search.tsx）にマスタデータによる検索フィルタを追加
  - トラブル種類、損傷の種類、出荷元倉庫、運送会社による検索機能を実装
  - マスタデータの動的読み込みとローディング状態の表示

#### 型定義とフック更新
- **型定義の統合**
  - 古いapi-typesから新しいtypesへの移行完了
  - React Hooks（hooks.ts）を新しい型定義に更新
  - 添付ファイル関連コンポーネントの型定義更新

- **マスタデータフック**
  - useMasterDataカスタムフックの活用
  - インシデントフォーム、検索コンポーネントでのマスタデータ統合

#### 技術的な改善
- **パッケージ依存関係**
  - @heroicons/reactパッケージの追加（--legacy-peer-depsで解決）
  - React 19.1.0との互換性確保

- **コンポーネント設計**
  - 共通コンポーネント（MasterSelect、ColorPicker）の活用
  - 型安全性の確保と実行時エラーの防止

### 2025-08-29 3.15.2 バックエンド実装 完了
- [x] 3.15.2 バックエンド実装の完了
  - [x] マスタデータエンティティの作成
    - TroubleType（トラブル種類マスタ）
    - DamageType（損傷種類マスタ）
    - Warehouse（出荷元倉庫マスタ）
    - ShippingCompany（運送会社マスタ）
  - [x] マスタデータリポジトリの実装
    - 各マスタ用のリポジトリインターフェースと実装
    - アクティブデータ取得、ソート順取得、名前重複チェック等の機能
  - [x] マスタ管理APIの実装
    - TroubleTypesController（CRUD操作、一覧取得、有効/無効化）
    - DamageTypesController（カテゴリ別取得機能含む）
    - WarehousesController（所在地・連絡先管理）
    - ShippingCompaniesController（会社種別別取得機能含む）
  - [x] Incidentエンティティの更新
    - EnumベースからマスタIDベースへの変更完了
    - ナビゲーションプロパティの追加
    - コンストラクタとメソッドの更新
  - [x] DTOクラスの更新
    - 各マスタ用のDTO（表示用、作成用、更新用）
    - IncidentDtoにマスタ情報表示用プロパティを追加
  - [x] バリデーションの更新
    - 各マスタ用の作成・更新バリデーションクラス
    - 日本語エラーメッセージ対応
  - [x] DIコンテナへの登録
    - マスタデータリポジトリの登録
    - バリデーションクラスの自動登録
  - [x] 見積時間: 12時間（実際の作業時間: 約10時間）

### 2025-08-29: マスタ管理機能拡張 - データベース設計・作成完了
- [x] 3.15.1 データベース設計・作成の実装
  - [x] マスタテーブル作成スクリプト（06_CreateMasterTables.sql）の作成
    - TroubleTypesテーブル（トラブル種類マスタ）
    - DamageTypesテーブル（損傷種類マスタ）
    - Warehousesテーブル（出荷元倉庫マスタ）
    - ShippingCompaniesテーブル（運送会社マスタ）
    - インデックス・制約・一意制約の設定
  - [x] 初期データ投入スクリプト（07_InsertMasterData.sql）の作成
    - トラブル種類初期データ（10件）
    - 損傷種類初期データ（8件）
    - 出荷元倉庫初期データ（4件）
    - 運送会社初期データ（5件）
  - [x] Incidentsテーブル更新スクリプト（08_UpdateIncidentsTable.sql）の作成
    - 新しいマスタIDカラムの追加
    - 既存データの移行処理（Enum値からマスタIDへの変換）
    - 外部キー制約の追加
    - 古いEnumカラムの削除
  - [x] 実行手順書（README_MasterTables.md）の作成
    - スクリプト実行手順の詳細化
    - 確認方法とトラブルシューティング
    - バックアップとロールバック手順
  - [x] 見積時間: 6時間（実際の作業時間: 約5時間）

### 2025-08-26: インシデント編集時の403エラー短期対応
- [x] インシデント編集時の403 Forbiddenエラーの原因調査
  - バックエンドの認証・認可設定不備を特定
  - フロントエンドの認証トークン未送信を確認
- [x] 短期対応の実装
  - Program.csで認証・認可を一時的に無効化
  - インシデント編集機能の復旧
- [x] 中期以降の対応計画策定
  - 認証・認可システムの緊急実装フェーズを追加
  - 包括的なセキュリティシステムの実装計画を策定
  - セキュリティ制約と注意事項を追加
- [x] 見積時間: 2時間

### 2025-08-25: シードデータの不足情報補完
- [x] 画像の表示内容に合致するテストデータの作成
  - トラブル種類を10種類に拡張（商品トラブル、配送トラブル、システムトラブル、設備トラブル、品質トラブル、物流トラブル、管理トラブル、安全トラブル、環境トラブル、その他のトラブル）
  - 損傷の種類に"該当なし"の値を追加
  - 出荷元倉庫に"該当なし"の値を追加
  - 運送会社名に"該当なし"の値を追加
- [x] フロントエンドの型定義とヘルパー関数の更新
  - 文字列ベースの列挙型に対応
  - 画像の表示内容と一致する日本語表示名の設定
  - トラブル種類の色分け（商品トラブル: 赤、その他: オレンジ）
  - 有効性確認の色分け（未実施: グレー、実施: 緑）

### 2025-08-21: 統計グラフの初期表示変更
- [x] 初期表示の変更
  - 年間表示（`selectedMonth = 0`）から当月表示（`selectedMonth = thisMonth`）に変更
  - 当年度・当月のデータが初期表示されるよう改善
  - より実用的な初期状態の設定

### 2025-08-21: 月間発生件数グラフのレイアウト改善
- [x] グラフのレスポンシブ対応
  - 固定幅（800px）からレスポンシブコンテナに変更
  - `ResponsiveContainer`コンポーネントの導入
  - コンテナ幅に合わせたグラフサイズの自動調整
  - 右側の空きスペースの解消
  - 提供サイトのレイアウトに近づけた改善

### 2025-08-21: タブ背景色の修正
- [x] タブの選択状態の背景色修正
  - CSS変数の直接適用による物流システム専用青色の確実な表示
  - `@layer components`を使用したタブ選択状態のスタイル定義
  - `!important`を使用したスタイルの優先度確保
  - ライトモード・ダークモード両方での動作確認
  - ホバー状態でも青色が維持されるよう調整

### 2025-08-21: 統計グラフのタブカラー改善
- [x] タブの選択状態の視認性向上
  - 選択中のタブを青色（`bg-logistics-blue`）に変更
  - 選択中のタブのテキストを白色に変更
  - ホバー効果の追加（`hover:bg-gray-100`、`dark:hover:bg-gray-800`）
  - トランジション効果の改善（`transition-[color,box-shadow,background-color]`）
  - ダークモード対応（`dark:data-[state=active]:bg-logistics-blue`）

### 2025-08-21: UI要素の調整完了
- [x] カラーパレットの統一
  - 物流システム専用カラーの定義（logistics-blue, logistics-red, logistics-orange等）
  - CSS変数による一貫したカラー管理
  - ダークモード対応カラーパレット
- [x] ヘッダーの調整
  - タイトルを「物流トラブル管理」に変更
  - 物流トラブル登録ボタンを青色に変更
- [x] ダッシュボードの調整
  - 統計カードの色分け（総インシデント: 青、未解決: 赤、解決済み: 緑、平均解決時間: オレンジ）
  - 円グラフのカラーパレットを画像のデザインに合わせて調整
  - ローディングスピナーの色を統一
- [x] 一覧セクションの改善
  - 検索バーのプレースホルダーを「物流トラブルを検索...」に変更
  - CSV出力ボタンの追加
  - テーブルヘッダーの調整（フォントウェイト、ヘッダー名）
  - トラブル種類のバッジ表示（商品トラブル: 赤、配送トラブル: オレンジ）
  - 有効性確認のバッジ表示（実施: 緑、未実施: グレー）
- [x] 全体的なUI改善
  - 一貫したカラーパレットの適用
  - スペーシングとマージンの調整
  - 視覚的な階層の改善

### 2025-08-21: UI/UXデザイン改善計画
- [ ] 提供サイトデザインへの準拠
  - メインページのレイアウト変更（分析セクション上部、一覧セクション下部）
  - 分析セクションの新規作成（フィルター、主要指標、グラフ）
  - 一覧セクションの改善（検索バー、CSV出力、テーブル調整）
  - UI要素の調整（ボタン配置、カラーパレット、スペーシング）

### 2025-08-21: 統計グラフの月間表示機能修正
- [x] バックエンドの統計APIを発生日ベースに修正
  - 統計サマリーAPIのフィルタを発生日ベースに変更
  - 損傷種類・トラブル種類グラフAPIのフィルタを発生日ベースに変更
  - 月間発生件数グラフAPIのフィルタを発生日ベースに変更
  - 年間表示・月間表示の両方で発生日を基準とした正確な統計データを提供

### 2025-08-21: 統計グラフの月間表示機能追加
- [x] バックエンドAPIの月間対応
  - 統計サマリーAPIに月パラメータを追加
  - 損傷種類・トラブル種類グラフAPIに月パラメータを追加
  - 月間発生件数グラフAPIに月パラメータを追加（月間表示時は日別集計）
  - 統計計算ロジックの月間フィルタ対応
- [x] フロントエンドの月選択UI実装
  - ダッシュボード画面に月選択ドロップダウンを追加
  - 統計・分析画面に月選択ドロップダウンを追加
  - 年度・月の両方を指定可能なフィルタ機能
  - 年間表示（月=0）と月間表示（月=1-12）の切り替え
- [x] 統計データの動的表示対応
  - APIクライアントに月パラメータを追加
  - 統計関連hooksに月パラメータを追加
  - グラフタイトルの動的更新（年間/月間表示）
  - タブ名の動的更新（月間発生件数/日別発生件数）
- [x] 動作確認とテスト
  - 年間表示と月間表示の切り替えテスト
  - 統計データの正確なフィルタリング確認
  - グラフ表示の正常動作確認

### 2025-08-21: 物流トラブル登録フォームのUI改善
- [x] 発生日フィールドのカレンダー選択機能強化
  - 発生日フィールドにカレンダーアイコンを追加
  - ヘルプテキスト「カレンダーから日付を選択してください」を追加
  - 有効性確認日フィールドにもカレンダーアイコンを追加して一貫性を確保
- [x] 発生日と発生場所のレイアウト変更
  - 横並び（grid grid-cols-1 md:grid-cols-2）から縦並びに変更
  - より見やすく使いやすいレイアウトに改善

### 2025-08-21: 一覧表示の発生日ベース変更
- [x] 物流トラブル一覧の表示日付を発生日に変更
  - フロントエンドの一覧ヘッダーを「日付」から「発生日」に変更
  - 表示データをreportedDateからoccurrenceDateに変更
  - フロントエンドのデフォルトソート設定を発生日に変更
  - バックエンドのソート条件にoccurrenceDateを追加
  - バックエンドのデフォルトソート設定を発生日に変更
  - 発生日の昇順・降順ソート機能が正常動作することを確認

### 2025-08-21: 発生日必須化対応
- [x] 発生日フィールドの必須化
  - バックエンドのバリデーションに発生日必須チェックを追加
  - フロントエンドのフォームで発生日を必須項目に変更
  - 型定義で発生日を必須フィールドに変更
  - HTML5バリデーションとバックエンドバリデーションの両方が正常動作することを確認

### 2025-08-21: APIエラー修正
- [x] 物流トラブル登録フォームの制御コンポーネントエラー修正
  - フォームデータのプロパティ名をcamelCaseに統一
  - 新規作成時のフォームリセット処理を修正
  - 全てのフォーム要素の参照を統一されたプロパティ名に変更

- [x] 物流トラブル登録APIエラーの修正
  - 日付フィールドの空文字列をnullに変換する処理を追加
  - フロントエンド・バックエンド間の型定義の整合性を確保
  - APIリクエストの正常動作を確認

### 🔴 フェーズ3.17: Next.js App Router最適化 (優先度: 高)
- [x] 3.17.1 ページリロードの最適化
  - [x] frontend/src/app/page.tsxのwindow.location.reload()をrouter.refresh()に置き換え
  - [x] useRouterフックのインポートと実装
  - [x] 3箇所の置き換え完了（handleCreateIncident、handleUpdateIncident、handleDeleteIncident）
  - [x] サーバーコンポーネントの再検証による効率的なデータ更新
  - [x] フルページリロードの回避によるUX向上
  - [x] 見積時間: 1時間

- [x] 3.17.2 日付処理と状態管理の最適化
  - [x] frontend/src/app/incidents/page.tsxのuseEffect最適化
  - [x] toISOString()によるUTC日付シフト問題の解決
  - [x] 関数型状態更新による古い状態参照問題の解決
  - [x] ローカル日付ゲッター（getFullYear、getMonth、getDate）による日付フォーマット
  - [x] YYYY-MM-DD形式での日付文字列生成
  - [x] フィルタクリア時のundefined設定
  - [x] 見積時間: 1時間

- [x] 3.17.3 エラーメッセージ表示の安全性向上
  - [x] frontend/src/app/incidents/page.tsxのエラー表示部分の修正
  - [x] incidentsErrorの安全な正規化関数（normalizeErrorMessage）の実装
  - [x] 文字列、Errorオブジェクト、任意のオブジェクトへの対応
  - [x] JSON.stringify失敗時のフォールバック処理
  - [x] 循環参照によるクラッシュの防止
  - [x] 見積時間: 0.5時間

### 🔴 フェーズ3.18: インシデント検索UI改善 (優先度: 高)
- [x] 3.18.1 クリアボタン表示条件の修正
  - [x] frontend/src/components/incident-search.tsxのクリアボタン表示条件にfromDateとtoDateを追加
  - [x] 日付フィルタのみが設定されている場合でもクリアボタンが表示されるように改善
  - [x] ユーザビリティの向上（日付フィルタクリアの容易化）
  - [x] 見積時間: 0.5時間

- [x] 3.18.2 マスタデータエラー処理の実装
  - [x] useMasterDataフックにリトライ機能（refetch）を追加
  - [x] incident-search.tsxコンポーネントにエラー状態の処理を追加
  - [x] ユーザーフレンドリーなエラーUIの実装（日本語メッセージ、アイコン、再試行ボタン）
  - [x] エラーログの出力（コンソール出力）
  - [x] リトライ機能によるマスタデータ再取得の実装
  - [x] 見積時間: 1時間

### 🔴 フェーズ3.19: セキュリティ強化 - PII保護 (優先度: 高)
- [x] 3.19.1 フロントエンドAPIクライアントのPII保護
  - [x] frontend/src/lib/api-client.tsのcreateIncidentメソッドのconsole.logを環境変数チェックで保護
  - [x] 開発環境（NODE_ENV === 'development'）でのみログ出力を許可
  - [x] センシティブなフィールド（incidentDetails、occurrenceLocation、summary、cause、preventionMeasures）をサニタイズ
  - [x] 本番環境でのPII露出リスクを完全に排除
  - [x] TypeScriptビルド確認と動作テスト
  - [x] 見積時間: 1時間

### 🔴 フェーズ3.20: CreateIncidentDtoのDTOレベルバリデーション実装 (優先度: 高)
- [x] 3.20.1 DTOレベルのバリデーション実装
  - [x] CreateIncidentDtoクラスにIValidatableObjectインターフェースを実装
  - [x] Enum値の検証（TroubleType、DamageType）を実装
  - [x] クロスフィールドルール（DefectiveItems <= TotalShipments、EffectivenessStatusとEffectivenessDateの関連）を実装
  - [x] 参照存在チェック（Warehouse、ShippingCompany）をアプリケーション/サービス層に移動
  - [x] 既存のFluentValidationクラスとの連携を実装
  - [x] テストコードの追加と動作確認
  - [x] 見積時間: 3時間

- [x] 3.20.2 アプリケーション層での参照存在チェック実装
  - [x] IncidentsControllerのCreateIncidentメソッドにマスタデータ参照存在チェックを追加
  - [x] IncidentsControllerのUpdateIncidentメソッドにマスタデータ参照存在チェックを追加
  - [x] 400/422エラーの適切な返却を実装
  - [x] 見積時間: 2時間

- [x] 3.20.3 テストと品質保証
  - [x] DTOレベルバリデーションのテストメソッドを追加
  - [x] Enum値検証、クロスフィールドルール、参照存在チェックのテストを実装
  - [x] 既存テストの修正と動作確認
  - [x] 見積時間: 1時間

### 🔴 フェーズ3.21: N+1問題解決とパフォーマンス最適化 (優先度: 高)
- [x] 3.21.1 バッチ処理によるN+1問題の解決
  - [x] IMasterDataResolverServiceにGetIncidentMasterDataBatchAsyncメソッドを追加
  - [x] IncidentMasterDataBatchクラスの作成（マスタデータの辞書管理）
  - [x] MasterDataResolverServiceにバッチ処理メソッドを実装
  - [x] IRepository<T>にGetByIdsAsyncメソッドを追加
  - [x] Repository<T>にGetByIdsAsyncメソッドを実装
  - [x] IncidentsControllerにConvertToDtoBatchAsyncメソッドを追加
  - [x] 既存のConvertToDtoAsync呼び出しをバッチ処理版に置き換え
  - [x] フォールバック処理の実装（エラー時の個別変換への切り替え）
  - [x] 見積時間: 4時間

- [x] 3.21.2 パフォーマンス改善の実装
  - [x] 外部キーの一括収集とユニーク化
  - [x] 並行処理によるマスタデータの一括取得
  - [x] 辞書ルックアップによる効率的なマッピング
  - [x] 非同期処理の保持と同期的な辞書アクセスの組み合わせ
  - [x] ビルド確認とエラーなしの確認
  - [x] 見積時間: 2時間

- [x] 3.21.3 重複コードの削除と定数化
  - [x] IncidentsControllerの重複したTimeSpan.FromDays(3)を特定（3箇所）
  - [x] クラスレベルの定数DefaultExpectedResolutionTimeを定義
  - [x] 重複箇所を定数参照に置換（GetIncidents、ConvertToDtoAsync、ConvertToDtoBatchAsync）
  - [x] 単一の情報源（Single Source of Truth）の実現
  - [x] コードの保守性と可読性の向上
  - [x] 見積時間: 1時間

### 🔴 フェーズ3.22: CreateIncidentDtoのバリデーション強化 (優先度: 高)
- [x] 3.22.1 Range属性による下限値バリデーションの追加
  - [x] TotalShipmentsプロパティに[Range(0, int.MaxValue)]属性を追加
  - [x] DefectiveItemsプロパティに[Range(0, int.MaxValue)]属性を追加
  - [x] 日本語エラーメッセージの設定（「出荷総数は0以上の値を入力してください。」「不良品数は0以上の値を入力してください。」）
  - [x] 負の値の入力を防止するバリデーションの実装
  - [x] 既存のValidateメソッドとの整合性確保（DefectiveItems <= TotalShipments）
  - [x] 見積時間: 1時間

### 🔴 フェーズ3.23: Incident.Createメソッドのenum値検証と例外テスト実装 (優先度: 高)
- [x] 3.23.1 Incident.Createメソッドのenum値検証実装
  - [x] Incident.Createメソッドにenum値の検証を追加
  - [x] ValidateEnumValueヘルパーメソッドの実装
  - [x] TroubleType、DamageType、Warehouse、ShippingCompanyのenum値検証
  - [x] 無効なenum値が渡された場合のArgumentExceptionスロー
  - [x] 見積時間: 2時間

- [x] 3.23.2 無効なenum値での例外テスト実装
  - [x] IncidentTests.csにCreate_WithInvalidEnumInt_ShouldThrowテストを追加
  - [x] 無効な整数値（9999）での各enumパラメータのテスト
  - [x] ArgumentExceptionのスロー確認とメッセージ内容の検証
  - [x] 見積時間: 1時間

- [x] 3.23.3 他のIncident.Create使用箇所の移行状況確認
  - [x] 統合テスト、DatabaseSeeder、IncidentRepositoryTests、IncidentsControllerでの使用状況確認
  - [x] すべての箇所でenum値を適切にキャストして使用していることを確認
  - [x] マスタデータ参照存在チェックによる適切なガード実装の確認
  - [x] 見積時間: 1時間

### 🔴 フェーズ3.24: 数値入力バリデーション強化 (優先度: 高)
- [x] 3.24.1 数値入力フィールドの安全なバリデーション実装
  - [x] frontend/src/components/incident-form.tsxにvalidateNumericInput関数を追加
  - [x] 入力値のトリム、10進数パース、数値検証、範囲チェック、クリッピングを実装
  - [x] 既存のparseInt(e.target.value) || 0を安全なバリデーション処理に置き換え
  - [x] totalShipmentsとdefectiveItemsフィールドのバリデーション改善
  - [x] 負の値、非数値文字列、安全整数範囲外の値の適切な処理
  - [x] 見積時間: 1時間

### 🔴 フェーズ3.25: マスタデータID検証の改善 (優先度: 高)
- [x] 3.25.1 マスタデータIDの安全な検証実装
  - [x] frontend/src/components/incident-form.tsxにvalidateMasterDataId関数を追加
  - [x] null/undefinedチェック、正の整数チェックを実装
  - [x] getFirstValidId関数で有効なIDを持つ最初の要素を取得
  - [x] 配列の安全性チェック（空配列、idフィールド欠損）を実装
  - [x] 見積時間: 1時間

- [x] 3.25.2 エラーハンドリングとフォーム状態の安全性向上
  - [x] useEffect内のマスタデータID設定ロジックをtry/catchで囲む
  - [x] 検証されたIDのみをsetFormDataで設定
  - [x] エラー発生時はデフォルト値（0）をフォールバックとして設定
  - [x] 開発環境でのデバッグログ出力を実装
  - [x] 無条件でtroubleTypes[0].idなどを使用しない安全な実装
  - [x] 見積時間: 1時間

- [x] 3.25.3 品質保証とテスト
  - [x] TypeScriptビルド確認とコンパイルエラーなしの確認
  - [x] 既存のフォーム機能への影響なしの確認
  - [x] エラーハンドリングの動作確認
  - [x] 見積時間: 0.5時間

### 🔴 フェーズ3.26: マスタデータエラー処理の改善 (優先度: 高)
- [x] 3.26.1 曖昧性のないラベルへの置き換え
  - [x] '不明'リテラルを'未設定'に置き換え
  - [x] autoCategory構築時の曖昧な値の連結を回避
  - [x] 条件分岐による適切なカテゴリ生成ロジックの実装
  - [x] 見積時間: 1時間

- [x] 3.26.2 データ整合性チェックの実装
  - [x] マスタデータ不足時の警告ログ出力（console.warn）
  - [x] フォームエラーフラグ（hasMasterDataError）の追加
  - [x] マスタデータ不足項目の詳細記録
  - [x] 見積時間: 1時間

- [x] 3.26.3 UI/UX改善とエラー表示
  - [x] マスタデータエラー警告メッセージの表示
  - [x] 送信ボタンの色変更（エラー時は黄色）
  - [x] 送信前の確認ダイアログ表示
  - [x] エラー状態でも送信可能な設計
  - [x] 見積時間: 1時間

- [x] 3.26.4 品質保証とテスト
  - [x] TypeScriptビルド確認とコンパイルエラーなしの確認
  - [x] 既存のフォーム機能への影響なしの確認
  - [x] エラーハンドリングの動作確認
  - [x] 見積時間: 0.5時間

### 🔴 フェーズ3.27: UpdateIncidentDtoのバリデーション強化 (優先度: 高)
- [x] 3.27.1 EnumValueAttributeの作成
  - [x] backend/LogisticsTroubleManagement.Core/Validation/EnumValueAttribute.csの新規作成
  - [x] 指定されたenum型に対してint値の検証を行うカスタムバリデーション属性を実装
  - [x] null値は許可し、非null整数値はEnum.IsDefinedで検証
  - [x] 見積時間: 1時間

- [x] 3.27.2 UpdateIncidentDtoのバリデーション実装
  - [x] System.ComponentModel.DataAnnotationsのusing文を追加
  - [x] LogisticsTroubleManagement.Core.Validationのusing文を追加
  - [x] TroubleTypeプロパティに[EnumValue(typeof(TroubleType))]属性を追加
  - [x] DamageTypeプロパティに[EnumValue(typeof(DamageType))]属性を追加
  - [x] コンパイル時検証の復活と無効な整数値の防止
  - [x] 見積時間: 1時間

- [x] 3.27.3 品質保証とテスト
  - [x] プロジェクトのビルド確認とエラーなしの確認
  - [x] 既存のDTO機能への影響なしの確認
  - [x] バリデーション属性の動作確認
  - [x] 見積時間: 0.5時間

### 🔴 フェーズ3.28: PagedResultDtoのプロパティ名統一 (優先度: 高)
- [x] 3.28.1 フロントエンド・バックエンド間のプロパティ名不一致の解決
  - [x] フロントエンドのPagedResultDtoをpageNumberからpageに変更
  - [x] 検索DTOとの一貫性確保
  - [x] バックエンドレスポンスとの互換性維持
  - [x] 見積時間: 2時間

- [x] 3.28.2 フロントエンドでの使用箇所の更新
  - [x] 検証スクリプト（rg）による全使用箇所の特定
  - [x] pageNumber参照をpage参照に置換（incidents、attachments、effectiveness）
  - [x] 型定義の整合性確保
  - [x] 見積時間: 2時間

- [x] 3.28.3 単体/統合テストの追加
  - [x] ページネーションキーの整合性テスト（PagedResultDtoTests.cs）
  - [x] バックエンドレスポンスとの一致確認（統合テスト）
  - [x] JSON シリアライゼーションでのプロパティ名確認
  - [x] 見積時間: 1時間