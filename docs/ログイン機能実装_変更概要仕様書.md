# ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½å®Ÿè£… å¤‰æ›´æ¦‚è¦ä»•æ§˜æ›¸

**ä½œæˆæ—¥**: 2025-09-02  
**ä½œæˆè€…**: ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºãƒãƒ¼ãƒ   
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**å„ªå…ˆåº¦**: ğŸ”´ é«˜

## æ¦‚è¦

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ç‰©æµãƒˆãƒ©ãƒ–ãƒ«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã«ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®å¤‰æ›´æ¦‚è¦ã‚’å®šç¾©ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã€ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã€ãƒ­ãƒ¼ãƒ«åˆ¥ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºæ©Ÿèƒ½ã‚’å«ã¿ã¾ã™ã€‚

## èƒŒæ™¯ãƒ»ç›®çš„

### ç¾çŠ¶ã®å•é¡Œ
- ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯èªè¨¼ãƒ»èªå¯æ©Ÿèƒ½ãŒä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹
- ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç·¨é›†æ™‚ã«403 Forbiddenã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½ãŒæœªå®Ÿè£…ã®çŠ¶æ…‹

### å®Ÿè£…ã®ç›®çš„
- ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰
- ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã«ã‚ˆã‚‹é©åˆ‡ãªæ¨©é™ç®¡ç†
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«åˆ¥ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºã«ã‚ˆã‚‹æ¥­å‹™åŠ¹ç‡åŒ–

## æ©Ÿèƒ½è¦ä»¶

### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æ©Ÿèƒ½

#### 1.1 ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½
- **å…¥åŠ›é …ç›®**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å/ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
- **èªè¨¼æ–¹å¼**: JWTï¼ˆJSON Web Tokenï¼‰ãƒ™ãƒ¼ã‚¹
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚»ãƒƒã‚·ãƒ§ãƒ³ãªã—ï¼‰
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ã€ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒå¯¾ç­–

#### 1.2 ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½
- **ãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹åŒ–**: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®ãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹åŒ–
- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã‚¯ãƒªã‚¢

#### 1.3 ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¦ä»¶**: æœ€å°8æ–‡å­—ã€å¤§æ–‡å­—ãƒ»å°æ–‡å­—ãƒ»æ•°å­—ãƒ»è¨˜å·ã‚’å«ã‚€
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ**: ãƒ¡ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´**: ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´æ©Ÿèƒ½

### 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«ç®¡ç†

#### 2.1 ãƒ­ãƒ¼ãƒ«å®šç¾©
| ãƒ­ãƒ¼ãƒ«ID | ãƒ­ãƒ¼ãƒ«å | èª¬æ˜ | æ¨©é™ãƒ¬ãƒ™ãƒ« |
|----------|----------|------|------------|
| 1 | äº‹å‹™å“¡ (Clerk) | åŸºæœ¬çš„ãªã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç®¡ç† | ä½ |
| 2 | ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç®¡ç†è€… (Incident Manager) | ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆåˆ†é¡ãƒ»ç®¡ç† | ä¸­ |
| 3 | å€‰åº«æ‹…å½“ (Warehouse Staff) | è§£æ±ºç­–æ¤œè¨ãƒ»ç™»éŒ² | ä¸­ |
| 4 | ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€… (Admin) | å…¨æ©Ÿèƒ½ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† | é«˜ |

#### 2.2 æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹
| æ©Ÿèƒ½ | äº‹å‹™å“¡ | ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç®¡ç†è€… | å€‰åº«æ‹…å½“ | ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€… |
|------|--------|-------------------|----------|----------------|
| ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆé–²è¦§ | â—‹ | â—‹ | â—‹ | â—‹ |
| ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç™»éŒ² | â—‹ | â—‹ | â—‹ | â—‹ |
| ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç·¨é›† | â—‹ | â—‹ | â—‹ | â—‹ |
| ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå‰Šé™¤ | Ã— | Ã— | Ã— | â—‹ |
| ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆåˆ†é¡ | Ã— | â—‹ | Ã— | â—‹ |
| è§£æ±ºç­–ç™»éŒ² | Ã— | Ã— | â—‹ | â—‹ |
| åŠ¹æœæ¸¬å®š | Ã— | â—‹ | â—‹ | â—‹ |
| çµ±è¨ˆé–²è¦§ | â—‹ | â—‹ | â—‹ | â—‹ |
| ãƒã‚¹ã‚¿ç®¡ç† | Ã— | Ã— | Ã— | â—‹ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† | Ã— | Ã— | Ã— | â—‹ |

### 3. ãƒ­ãƒ¼ãƒ«åˆ¥ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

#### 3.1 äº‹å‹™å“¡ (Clerk)
**ãƒ­ã‚°ã‚¤ãƒ³æ™‚è¡¨ç¤ºé …ç›®:**
- æœªè§£æ±ºã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ
- å¯¾å¿œä¸­ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ

**ä¸»è¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:**
- æ–°è¦ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®ç™»éŒ²
- æ‹…å½“ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®ç·¨é›†ãƒ»æ›´æ–°

#### 3.2 ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç®¡ç†è€… (Incident Manager)
**ãƒ­ã‚°ã‚¤ãƒ³æ™‚è¡¨ç¤ºé …ç›®:**
- æœªè§£æ±ºã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ
- å¯¾å¿œä¸­ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ


**ä¸»è¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:**
- ç™»éŒ²ã•ã‚ŒãŸã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®ç¨®é¡åˆ†ã‘
- ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®å„ªå…ˆåº¦è¨­å®š
- æ‹…å½“è€…ã®å‰²ã‚Šå½“ã¦

#### 3.3 å€‰åº«æ‹…å½“ (Warehouse Staff)
**ãƒ­ã‚°ã‚¤ãƒ³æ™‚è¡¨ç¤ºé …ç›®:**
- æœªè§£æ±ºã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ
- å¯¾å¿œä¸­ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç´ã¥ãå€‰åº«ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ
- ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç®¡ç†è€…ã«ç¨®é¡åˆ†ã‘ã•ã‚ŒãŸã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ

**ä¸»è¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:**
- è§£æ±ºç­–ã®æ¤œè¨ãƒ»ç™»éŒ²
- åŠ¹æœæ¸¬å®šã®å®Ÿæ–½
- å†ç™ºé˜²æ­¢ç­–ã®ææ¡ˆ

#### 3.4 ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€… (Admin)
**ãƒ­ã‚°ã‚¤ãƒ³æ™‚è¡¨ç¤ºé …ç›®:**
- å…¨ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®æ¦‚è¦
- ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆæƒ…å ±
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æƒ…å ±

**ä¸»è¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:**
- å…¨æ©Ÿèƒ½ã®åˆ©ç”¨
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ãƒ­ãƒ¼ãƒ«ç®¡ç†
- ã‚·ã‚¹ãƒ†ãƒ è¨­å®šç®¡ç†

## æŠ€è¡“ä»•æ§˜

### 1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…

#### 1.1 èªè¨¼ãƒ»èªå¯ã‚·ã‚¹ãƒ†ãƒ 
- **èªè¨¼æ–¹å¼**: JWTï¼ˆJSON Web Tokenï¼‰
- **ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™**: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³24æ™‚é–“ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³7æ—¥
- **æš—å·åŒ–**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯bcryptã§ãƒãƒƒã‚·ãƒ¥åŒ–
- **ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢**: JWTèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã€ãƒ­ãƒ¼ãƒ«èªå¯ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

#### 1.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ
**Usersãƒ†ãƒ¼ãƒ–ãƒ«æ‹¡å¼µ:**
```sql
ALTER TABLE Users ADD
    PasswordHash NVARCHAR(MAX) NOT NULL,
    LastLoginAt DATETIME2 NULL,
    RefreshToken NVARCHAR(MAX) NULL,
    RefreshTokenExpiry DATETIME2 NULL;
```

**Rolesãƒ†ãƒ¼ãƒ–ãƒ«æ–°è¦ä½œæˆ:**
```sql
CREATE TABLE Roles (
    Id INT PRIMARY KEY IDENTITY(1,1),
    Name NVARCHAR(50) NOT NULL UNIQUE,
    Description NVARCHAR(200) NULL,
    IsActive BIT NOT NULL DEFAULT 1,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
    UpdatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE()
);
```

**æ—¢å­˜Roleãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ´»ç”¨:**
- `Users.Role`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’`Roles`ãƒ†ãƒ¼ãƒ–ãƒ«ã®å¤–éƒ¨ã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨
- è¤‡é›‘ãªä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ä¸è¦ã§ã€ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆã‚’æ¡ç”¨

#### 1.3 APIè¨­è¨ˆ
**èªè¨¼API:**
- `POST /api/auth/login` - ãƒ­ã‚°ã‚¤ãƒ³
- `POST /api/auth/logout` - ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
- `POST /api/auth/refresh` - ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
- `POST /api/auth/change-password` - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
- `POST /api/auth/forgot-password` - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆè¦æ±‚
- `POST /api/auth/reset-password` - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†API:**
- `GET /api/users/profile` - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
- `PUT /api/users/profile` - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°
- `GET /api/users` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
- `POST /api/users` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
- `PUT /api/users/{id}` - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
- `DELETE /api/users/{id}` - ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰

### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

#### 2.1 èªè¨¼UI
- **ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢**: `/login`
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç”»é¢**: `/forgot-password`
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ç”»é¢**: `/change-password`

#### 2.2 èªè¨¼çŠ¶æ…‹ç®¡ç†
- **Context API**: èªè¨¼çŠ¶æ…‹ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ç®¡ç†
- **ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã®ä¿å­˜
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ä¿å­˜

#### 2.3 ãƒ«ãƒ¼ãƒˆä¿è­·
- **Protected Route**: èªè¨¼ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸ã®ä¿è­·
- **Role-based Route**: ãƒ­ãƒ¼ãƒ«åˆ¥ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ**: æœªèªè¨¼æ™‚ã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸ã®èª˜å°

#### 2.4 ãƒ­ãƒ¼ãƒ«åˆ¥ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- **å‹•çš„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: ãƒ­ãƒ¼ãƒ«ã«å¿œã˜ãŸè¡¨ç¤ºå†…å®¹ã®åˆ‡ã‚Šæ›¿ãˆ
- **æ¡ä»¶ä»˜ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°**: æ¨©é™ã«å¿œã˜ãŸUIè¦ç´ ã®è¡¨ç¤ºãƒ»éè¡¨ç¤º
- **ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ­ãƒ¼ãƒ«åˆ¥ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤º

## æ—¢å­˜APIã¸ã®å½±éŸ¿ã¨å¯¾å¿œç­–

### 1. èªè¨¼ãƒ»èªå¯ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®è¿½åŠ 

#### 1.1 å½±éŸ¿ã‚’å—ã‘ã‚‹ç®‡æ‰€
- `Program.cs` - èªè¨¼ãƒ»èªå¯ã‚µãƒ¼ãƒ“ã‚¹ã®ç™»éŒ²
- å…¨APIã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ - èªè¨¼ãƒ»èªå¯å±æ€§ã®è¿½åŠ 

#### 1.2 å…·ä½“çš„ãªå¤‰æ›´å†…å®¹
**Program.csã¸ã®è¿½åŠ :**
```csharp
// èªè¨¼ãƒ»èªå¯ã‚µãƒ¼ãƒ“ã‚¹ã®ç™»éŒ²
builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer(options => {
        options.TokenValidationParameters = new TokenValidationParameters
        {
            ValidateIssuer = true,
            ValidateAudience = true,
            ValidateLifetime = true,
            ValidateIssuerSigningKey = true,
            ValidIssuer = builder.Configuration["Jwt:Issuer"],
            ValidAudience = builder.Configuration["Jwt:Audience"],
            IssuerSigningKey = new SymmetricSecurityKey(
                Encoding.UTF8.GetBytes(builder.Configuration["Jwt:Key"]))
        };
    });

// èªå¯ãƒãƒªã‚·ãƒ¼ã®è¨­å®š
builder.Services.AddAuthorization(options => {
    options.AddPolicy("AdminOnly", policy => policy.RequireRole("Admin"));
    options.AddPolicy("ManagerOnly", policy => policy.RequireRole("IncidentManager"));
    options.AddPolicy("WarehouseStaff", policy => policy.RequireRole("WarehouseStaff"));
    options.AddPolicy("ClerkOrAbove", policy => policy.RequireRole("Clerk", "IncidentManager", "WarehouseStaff", "Admin"));
});

// ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®è¿½åŠ ï¼ˆUseRoutingã®å¾Œã«é…ç½®ï¼‰
app.UseAuthentication();
app.UseAuthorization();
```

#### 1.3 æ—¢å­˜ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¸ã®èªè¨¼ãƒ»èªå¯å±æ€§è¿½åŠ 

**IncidentsController.cs:**
```csharp
[Authorize] // å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«èªè¨¼å¿…é ˆ
[ApiController]
[Route("api/[controller]")]
public class IncidentsController : ControllerBase
{
    [Authorize(Roles = "Clerk,IncidentManager,WarehouseStaff,Admin")]
    [HttpGet]
    public async Task<ActionResult<PagedResultDto<IncidentDto>>> GetIncidents([FromQuery] GetIncidentsQuery query)
    {
        // æ—¢å­˜ã®å®Ÿè£…
    }

    [Authorize(Roles = "Clerk,IncidentManager,WarehouseStaff,Admin")]
    [HttpPost]
    public async Task<ActionResult<IncidentDto>> CreateIncident([FromBody] CreateIncidentDto dto)
    {
        // æ—¢å­˜ã®å®Ÿè£… + ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®è¿½åŠ 
        var userId = User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
        dto.CreatedByUserId = int.Parse(userId);
        // æ—¢å­˜ã®å®Ÿè£…
    }

    [Authorize(Roles = "IncidentManager,Admin")]
    [HttpPut("{id}/classify")]
    public async Task<ActionResult> ClassifyIncident(int id, [FromBody] ClassifyIncidentDto dto)
    {
        // æ—¢å­˜ã®å®Ÿè£…
    }
}
```

**WarehousesController.cs:**
```csharp
[Authorize(Roles = "WarehouseStaff,Admin")]
[ApiController]
[Route("api/[controller]")]
public class WarehousesController : ControllerBase
{
    // æ—¢å­˜ã®å®Ÿè£…ï¼ˆå€‰åº«æ‹…å½“ãƒ»ç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰
}
```

**StatisticsController.cs:**
```csharp
[Authorize(Roles = "Clerk,IncidentManager,WarehouseStaff,Admin")]
[ApiController]
[Route("api/[controller]")]
public class StatisticsController : ControllerBase
{
    // æ—¢å­˜ã®å®Ÿè£…ï¼ˆå…¨ãƒ­ãƒ¼ãƒ«ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰
}
```

**MasterDataControllers:**
```csharp
[Authorize(Roles = "Admin")]
[ApiController]
[Route("api/[controller]")]
public class IncidentTypesController : ControllerBase
{
    // æ—¢å­˜ã®å®Ÿè£…ï¼ˆç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰
}
```

### 2. DTOãƒ»ãƒ¢ãƒ‡ãƒ«ã®æ‹¡å¼µ

#### 2.1 å½±éŸ¿ã‚’å—ã‘ã‚‹DTO
**æ—¢å­˜ã®ä½œæˆãƒ»æ›´æ–°DTOã¸ã®è¿½åŠ :**
```csharp
// CreateIncidentDto
public class CreateIncidentDto : IValidatableObject
{
    // æ—¢å­˜ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£...
    
    // æ–°è¦è¿½åŠ ï¼ˆèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰è‡ªå‹•è¨­å®šï¼‰
    public int CreatedByUserId { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
}

// UpdateIncidentDto
public class UpdateIncidentDto : IValidatableObject
{
    // æ—¢å­˜ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£...
    
    // æ–°è¦è¿½åŠ 
    public int UpdatedByUserId { get; set; }
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}
```

**æ—¢å­˜ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹DTOã¸ã®è¿½åŠ :**
```csharp
// IncidentDto
public class IncidentDto
{
    // æ—¢å­˜ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£...
    
    // æ–°è¦è¿½åŠ 
    public int CreatedByUserId { get; set; }
    public string CreatedByUserName { get; set; }
    public DateTime CreatedAt { get; set; }
    public int? UpdatedByUserId { get; set; }
    public string UpdatedByUserName { get; set; }
    public DateTime? UpdatedAt { get; set; }
}
```

#### 2.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å½±éŸ¿

**æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã®ä½œæˆ:**
```sql
-- Incidentsãƒ†ãƒ¼ãƒ–ãƒ«ã®æ–°è¦ä½œæˆï¼ˆèªè¨¼æ©Ÿèƒ½å¯¾å¿œç‰ˆï¼‰
CREATE TABLE Incidents (
    Id INT PRIMARY KEY IDENTITY(1,1),
    Title NVARCHAR(200) NOT NULL,
    Description NVARCHAR(MAX) NULL,
    Status INT NOT NULL,
    Priority INT NOT NULL,
    IncidentTypeId INT NOT NULL,
    WarehouseId INT NOT NULL,
    CreatedByUserId INT NOT NULL,
    CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
    UpdatedByUserId INT NULL,
    UpdatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
    FOREIGN KEY (IncidentTypeId) REFERENCES IncidentTypes(Id),
    FOREIGN KEY (WarehouseId) REFERENCES Warehouses(Id),
    FOREIGN KEY (CreatedByUserId) REFERENCES Users(Id),
    FOREIGN KEY (UpdatedByUserId) REFERENCES Users(Id)
);

-- æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ãŒã‚ã‚‹å ´åˆã®æ‹¡å¼µï¼ˆé–‹ç™ºç’°å¢ƒã§ã®ç§»è¡Œç”¨ï¼‰
-- ALTER TABLE Incidents ADD
--     CreatedByUserId INT NULL,
--     CreatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
--     UpdatedByUserId INT NULL,
--     UpdatedAt DATETIME2 NOT NULL DEFAULT GETUTCDATE();

-- æ—¢å­˜Roleãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„è¿½åŠ 
ALTER TABLE Users ADD CONSTRAINT FK_Users_Role 
    FOREIGN KEY (Role) REFERENCES Roles(Id);
```

**åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥ç”¨SQL:**
```sql
-- ãƒ­ãƒ¼ãƒ«ã®åˆæœŸãƒ‡ãƒ¼ã‚¿
INSERT INTO Roles (Name, Description, IsActive) VALUES
('Clerk', 'äº‹å‹™å“¡ - åŸºæœ¬çš„ãªã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç®¡ç†', 1),
('IncidentManager', 'ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç®¡ç†è€… - ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆåˆ†é¡ãƒ»ç®¡ç†', 1),
('WarehouseStaff', 'å€‰åº«æ‹…å½“ - è§£æ±ºç­–æ¤œè¨ãƒ»ç™»éŒ²', 1),
('Admin', 'ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€… - å…¨æ©Ÿèƒ½ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†', 1);

-- ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆï¼ˆåˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: Admin123!ï¼‰
INSERT INTO Users (Username, Email, Role, PasswordHash, IsActive, CreatedAt, UpdatedAt) VALUES
('admin', 'admin@example.com', 4, '$2a$11$YourHashedPasswordHere', 1, GETUTCDATE(), GETUTCDATE());

-- ãƒ†ã‚¹ãƒˆç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆï¼ˆåˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: Test123!ï¼‰
INSERT INTO Users (Username, Email, Role, PasswordHash, IsActive, CreatedAt, UpdatedAt) VALUES
('clerk1', 'clerk1@example.com', 1, '$2a$11$YourHashedPasswordHere', 1, GETUTCDATE(), GETUTCDATE()),
('manager1', 'manager1@example.com', 2, '$2a$11$YourHashedPasswordHere', 1, GETUTCDATE(), GETUTCDATE()),
('warehouse1', 'warehouse1@example.com', 3, '$2a$11$YourHashedPasswordHere', 1, GETUTCDATE(), GETUTCDATE());

-- ãƒ†ã‚¹ãƒˆç”¨ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ
INSERT INTO Incidents (Title, Description, Status, Priority, IncidentTypeId, WarehouseId, CreatedByUserId, CreatedAt, UpdatedAt) VALUES
('ãƒ†ã‚¹ãƒˆã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ1', 'ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºæ®µéšã§ã®ãƒ†ã‚¹ãƒˆç”¨ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ', 1, 2, 1, 1, 1, GETUTCDATE(), GETUTCDATE()),
('ãƒ†ã‚¹ãƒˆã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ2', 'èªè¨¼æ©Ÿèƒ½å®Ÿè£…å‰ã®ãƒ†ã‚¹ãƒˆç”¨ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ', 1, 1, 2, 1, 1, GETUTCDATE(), GETUTCDATE());
```

### 3. ãƒªãƒã‚¸ãƒˆãƒªãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã®å¤‰æ›´

#### 3.1 å½±éŸ¿ã‚’å—ã‘ã‚‹ã‚µãƒ¼ãƒ“ã‚¹
**IncidentService.cs:**
```csharp
public async Task<IncidentDto> CreateIncidentAsync(CreateIncidentDto dto, int userId)
{
    // æ—¢å­˜ã®å®Ÿè£…...
    
    // æ–°è¦è¿½åŠ 
    incident.CreatedByUserId = userId;
    incident.CreatedAt = DateTime.UtcNow;
    
    // æ—¢å­˜ã®å®Ÿè£…...
}

public async Task<IncidentDto> UpdateIncidentAsync(int id, UpdateIncidentDto dto, int userId)
{
    // æ—¢å­˜ã®å®Ÿè£…...
    
    // æ–°è¦è¿½åŠ 
    incident.UpdatedByUserId = userId;
    incident.UpdatedAt = DateTime.UtcNow;
    
    // æ—¢å­˜ã®å®Ÿè£…...
}
```

#### 3.2 ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å–å¾—
**BaseController.csï¼ˆæ–°è¦ä½œæˆï¼‰:**
```csharp
[ApiController]
public abstract class BaseController : ControllerBase
{
    protected int GetCurrentUserId()
    {
        var userIdClaim = User.FindFirst(ClaimTypes.NameIdentifier);
        if (userIdClaim == null || !int.TryParse(userIdClaim.Value, out int userId))
        {
            throw new UnauthorizedAccessException("ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒå–å¾—ã§ãã¾ã›ã‚“");
        }
        return userId;
    }

    protected string GetCurrentUserRole()
    {
        var roleClaim = User.FindFirst(ClaimTypes.Role);
        return roleClaim?.Value ?? string.Empty;
    }
}
```

### 4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ‹¡å¼µ

#### 4.1 æ—¢å­˜ã®ExceptionHandlingMiddlewareã¸ã®è¿½åŠ 
```csharp
public class ExceptionHandlingMiddleware
{
    // æ—¢å­˜ã®å®Ÿè£…...
    
    private async Task HandleExceptionAsync(HttpContext context, Exception exception)
    {
        context.Response.ContentType = "application/json";
        
        var (statusCode, message, code) = exception switch
        {
            // æ—¢å­˜ã®ã‚±ãƒ¼ã‚¹...
            
            // æ–°è¦è¿½åŠ 
            UnauthorizedAccessException => (401, "èªè¨¼ãŒå¿…è¦ã§ã™", "UNAUTHORIZED"),
            ForbiddenException => (403, "ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“", "FORBIDDEN"),
            InvalidTokenException => (401, "ãƒˆãƒ¼ã‚¯ãƒ³ãŒç„¡åŠ¹ã§ã™", "INVALID_TOKEN"),
            TokenExpiredException => (401, "ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™", "TOKEN_EXPIRED"),
            
            // æ—¢å­˜ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚±ãƒ¼ã‚¹...
            _ => (500, "å†…éƒ¨ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ", "INTERNAL_ERROR")
        };
        
        context.Response.StatusCode = statusCode;
        await context.Response.WriteAsJsonAsync(new
        {
            error = message,
            code = code,
            timestamp = DateTime.UtcNow
        });
    }
}
```

#### 4.2 ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ã‚¯ãƒ©ã‚¹ã®è¿½åŠ 
```csharp
public class ForbiddenException : Exception
{
    public ForbiddenException(string message = "ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“") : base(message) { }
}

public class InvalidTokenException : Exception
{
    public InvalidTokenException(string message = "ãƒˆãƒ¼ã‚¯ãƒ³ãŒç„¡åŠ¹ã§ã™") : base(message) { }
}

public class TokenExpiredException : Exception
{
    public TokenExpiredException(string message = "ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™") : base(message) { }
}
```

### 5. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å¤‰æ›´

#### 5.1 æ—¢å­˜ã®api.tsã¸ã®å½±éŸ¿
```typescript
// æ—¢å­˜ã®api.tsã«è¿½åŠ 
import { getAuthToken, logout } from '@/lib/auth';

const apiClient = axios.create({
    baseURL: '/api',
    headers: {
        'Content-Type': 'application/json',
    },
});

// èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•ä»˜ä¸
apiClient.interceptors.request.use((config) => {
    const token = getAuthToken();
    if (token) {
        config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
});

// èªè¨¼ã‚¨ãƒ©ãƒ¼ã®è‡ªå‹•å‡¦ç†
apiClient.interceptors.response.use(
    (response) => response,
    (error) => {
        if (error.response?.status === 401) {
            // è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
            logout();
            window.location.href = '/login';
        }
        return Promise.reject(error);
    }
);

// æ—¢å­˜ã®APIé–¢æ•°ã¯å¤‰æ›´ä¸è¦ï¼ˆèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ãŒè‡ªå‹•ã§ä»˜ä¸ã•ã‚Œã‚‹ï¼‰
export const getIncidents = async (params: GetIncidentsQuery): Promise<PagedResultDto<IncidentDto>> => {
    const response = await apiClient.get('/incidents', { params });
    return response.data;
};
```

#### 5.2 æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã®å½±éŸ¿
**æ—¢å­˜ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆä¸€è¦§ãƒ»è©³ç´°ç”»é¢:**
- èªè¨¼çŠ¶æ…‹ã®ç¢ºèª
- æ¨©é™ã«å¿œã˜ãŸãƒœã‚¿ãƒ³ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºãƒ»éè¡¨ç¤º
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ‹¡å¼µ

```typescript
// æ—¢å­˜ã®IncidentList.tsxã¸ã®è¿½åŠ 
const IncidentList = () => {
    const { user } = useAuth(); // æ–°è¦è¿½åŠ 
    
    // æ—¢å­˜ã®å®Ÿè£…...
    
    // æ¨©é™ã«å¿œã˜ãŸè¡¨ç¤ºåˆ¶å¾¡
    const canCreateIncident = ['Clerk', 'IncidentManager', 'WarehouseStaff', 'Admin'].includes(user?.role);
    const canDeleteIncident = user?.role === 'Admin';
    
    return (
        <div>
            {/* æ—¢å­˜ã®å®Ÿè£…... */}
            
            {canCreateIncident && (
                <Button onClick={handleCreateIncident}>æ–°è¦ä½œæˆ</Button>
            )}
            
            {/* æ—¢å­˜ã®å®Ÿè£…... */}
        </div>
    );
};
```

### 6. ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®æ›´æ–°

#### 6.1 æ—¢å­˜ã®å˜ä½“ãƒ†ã‚¹ãƒˆã¸ã®å½±éŸ¿
```csharp
// æ—¢å­˜ã®IncidentControllerTests.csã¸ã®è¿½åŠ 
[Test]
public async Task CreateIncident_WithValidData_ShouldSucceed()
{
    // æ—¢å­˜ã®ãƒ†ã‚¹ãƒˆ...
    
    // æ–°è¦è¿½åŠ ï¼šèªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®è¨­å®š
    var user = new ClaimsPrincipal(new ClaimsIdentity(new[]
    {
        new Claim(ClaimTypes.NameIdentifier, "1"),
        new Claim(ClaimTypes.Role, "Clerk")
    }, "Test"));
    
    _controller.ControllerContext = new ControllerContext
    {
        HttpContext = new DefaultHttpContext { User = user }
    };
    
    // æ—¢å­˜ã®ãƒ†ã‚¹ãƒˆ...
}

[Test]
public async Task CreateIncident_WithoutAuthentication_ShouldReturnUnauthorized()
{
    // æ–°è¦ãƒ†ã‚¹ãƒˆï¼šèªè¨¼ãªã—ã®å ´åˆ
    var dto = new CreateIncidentDto { /* æ—¢å­˜ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ */ };
    
    var result = await _controller.CreateIncident(dto);
    
    Assert.That(result.Result, Is.InstanceOf<UnauthorizedResult>());
}
```

### 7. æ®µéšçš„ç§»è¡Œã®ãŸã‚ã®è¨­å®š

#### 7.1 èªè¨¼ã®æ®µéšçš„é©ç”¨
**appsettings.json:**
```json
{
  "Authentication": {
    "RequireAuth": false, // æ®µéšçš„ç§»è¡Œç”¨ãƒ•ãƒ©ã‚°
    "Jwt": {
      "Key": "your-secret-key",
      "Issuer": "your-issuer",
      "Audience": "your-audience"
    }
  }
}
```

**Program.cs:**
```csharp
// æ®µéšçš„ç§»è¡Œã®ãŸã‚ã®æ¡ä»¶åˆ†å²
if (builder.Configuration.GetValue<bool>("Authentication:RequireAuth"))
{
    // èªè¨¼ãƒ»èªå¯ã®æœ‰åŠ¹åŒ–
    builder.Services.AddAuthentication(/* è¨­å®š */);
    builder.Services.AddAuthorization(/* è¨­å®š */);
    
    app.UseAuthentication();
    app.UseAuthorization();
}
else
{
    // èªè¨¼ãªã—ãƒ¢ãƒ¼ãƒ‰ï¼ˆé–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨ï¼‰
    builder.Services.AddScoped<IAuthenticationService, NoAuthService>();
}
```

#### 7.2 æ—¢å­˜APIã®æ®µéšçš„ä¿è­·
```csharp
// æ®µéšçš„ã«èªè¨¼ã‚’é©ç”¨ã™ã‚‹ãŸã‚ã®å±æ€§
[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method)]
public class ConditionalAuthorizeAttribute : AuthorizeAttribute
{
    public ConditionalAuthorizeAttribute()
    {
        var requireAuth = Configuration.GetValue<bool>("Authentication:RequireAuth");
        if (!requireAuth)
        {
            // èªè¨¼ãŒç„¡åŠ¹ãªå ´åˆã¯å±æ€§ã‚’ç„¡åŠ¹åŒ–
            this.GetType().GetProperty("Policy")?.SetValue(this, null);
        }
    }
}
```

## å®Ÿè£…è¨ˆç”»

å®Ÿè£…è¨ˆç”»ã®è©³ç´°ã¯`todo.md`ã®ã€Œãƒ•ã‚§ãƒ¼ã‚º3.29: ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½å®Ÿè£…ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 1. èªè¨¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦**: æœ€å°8æ–‡å­—ã€è¤‡é›‘æ€§è¦ä»¶
- **ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹å¯¾ç­–**: ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°åˆ¶é™
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: ãƒˆãƒ¼ã‚¯ãƒ³ã®é©åˆ‡ãªæœ‰åŠ¹æœŸé™è¨­å®š
- **HTTPSå¿…é ˆ**: æœ¬ç•ªç’°å¢ƒã§ã®æš—å·åŒ–é€šä¿¡

### 2. èªå¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **æœ€å°æ¨©é™ã®åŸå‰‡**: å¿…è¦æœ€å°é™ã®æ¨©é™ã®ã¿ä»˜ä¸
- **ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**: æ©Ÿèƒ½ãƒ¬ãƒ™ãƒ«ã§ã®æ¨©é™ç®¡ç†
- **APIä¿è­·**: èªè¨¼ãƒ»èªå¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®é©åˆ‡ãªé©ç”¨
- **å…¥åŠ›å€¤æ¤œè¨¼**: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®å³å¯†ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

### 3. ãƒ‡ãƒ¼ã‚¿ä¿è­·
- **å€‹äººæƒ…å ±**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç­‰ã®æ©Ÿå¯†æƒ…å ±ã®é©åˆ‡ãªä¿è­·
- **ç›£æŸ»ãƒ­ã‚°**: èªè¨¼ãƒ»èªå¯ã‚¤ãƒ™ãƒ³ãƒˆã®è¨˜éŒ²
- **ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–**: æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–ä¿å­˜

## éæ©Ÿèƒ½è¦ä»¶

### 1. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- **èªè¨¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 500msä»¥å†…
- **ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼**: 100msä»¥å†…
- **åŒæ™‚æ¥ç¶šæ•°**: 100ãƒ¦ãƒ¼ã‚¶ãƒ¼

### 2. å¯ç”¨æ€§
- **ç¨¼åƒç‡**: 99.5%ä»¥ä¸Š
- **éšœå®³å¾©æ—§**: 4æ™‚é–“ä»¥å†…
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: æ—¥æ¬¡ãƒ•ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

### 3. ä¿å®ˆæ€§
- **ãƒ­ã‚°å‡ºåŠ›**: æ§‹é€ åŒ–ãƒ­ã‚°ï¼ˆSerilogï¼‰
- **ç›£è¦–**: Application Insights
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

## ãƒªã‚¹ã‚¯ç®¡ç†

### 1. æŠ€è¡“çš„ãƒªã‚¹ã‚¯
- **JWTãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: é©åˆ‡ãªæš—å·åŒ–ãƒ»ç½²åã®å®Ÿè£…
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–**: æœ€æ–°ã®bcryptã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ä½¿ç”¨
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: ãƒˆãƒ¼ã‚¯ãƒ³ã®é©åˆ‡ãªç„¡åŠ¹åŒ–å‡¦ç†

### 2. é‹ç”¨ãƒªã‚¹ã‚¯
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†**: é©åˆ‡ãªæ¨©é™è¨­å®šã¨ç›£æŸ»
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ**: ã‚»ã‚­ãƒ¥ã‚¢ãªãƒªã‚»ãƒƒãƒˆãƒ•ãƒ­ãƒ¼
- **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒƒã‚¯**: ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹å¯¾ç­–

### 3. å¯¾å¿œç­–
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼**: å®Ÿè£…å‰å¾Œã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
- **ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ**: å¤–éƒ¨ã‹ã‚‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
- **ç›£æŸ»ãƒ­ã‚°**: å…¨èªè¨¼ãƒ»èªå¯ã‚¤ãƒ™ãƒ³ãƒˆã®è¨˜éŒ²

## ãƒ†ã‚¹ãƒˆè¨ˆç”»

### 1. å˜ä½“ãƒ†ã‚¹ãƒˆ
- **èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹**: ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ»ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹**: ãƒãƒƒã‚·ãƒ¥åŒ–ãƒ»æ¤œè¨¼
- **èªå¯ã‚µãƒ¼ãƒ“ã‚¹**: ãƒ­ãƒ¼ãƒ«ãƒ»æ¨©é™ãƒã‚§ãƒƒã‚¯

### 2. çµ±åˆãƒ†ã‚¹ãƒˆ
- **APIèªè¨¼**: ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ã®èªè¨¼ãƒ»èªå¯
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ãƒ­ãƒ¼ãƒ«ç®¡ç†ã®æ•´åˆæ€§
- **ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢**: èªè¨¼ãƒ»èªå¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®å‹•ä½œ

### 3. E2Eãƒ†ã‚¹ãƒˆ
- **ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼**: æ­£å¸¸ãƒ»ç•°å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¢ºèª
- **ãƒ­ãƒ¼ãƒ«åˆ¥ã‚¢ã‚¯ã‚»ã‚¹**: å„ãƒ­ãƒ¼ãƒ«ã§ã®æ©Ÿèƒ½åˆ©ç”¨ç¢ºèª
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã®é˜²æ­¢ç¢ºèª

## é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰è¨ˆç”»

### 1. é–‹ç™ºç’°å¢ƒã®æº–å‚™
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã§ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ
- **åˆæœŸãƒ‡ãƒ¼ã‚¿**: ãƒ†ã‚¹ãƒˆç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ãƒ­ãƒ¼ãƒ«ãƒ»ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥
- **èªè¨¼è¨­å®š**: JWTè¨­å®šã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ã®è¨­å®š

### 2. æ®µéšçš„å®Ÿè£…
- **Phase 1**: èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…ãƒ»å˜ä½“ãƒ†ã‚¹ãƒˆ
- **Phase 2**: æ—¢å­˜æ©Ÿèƒ½ã¸ã®èªè¨¼ãƒ»èªå¯é©ç”¨ãƒ»çµ±åˆãƒ†ã‚¹ãƒˆ
- **Phase 3**: ãƒ­ãƒ¼ãƒ«åˆ¥ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®å®Ÿè£…ãƒ»E2Eãƒ†ã‚¹ãƒˆ
- **Phase 4**: æœ¬æ ¼é‹ç”¨é–‹å§‹ãƒ»ç›£è¦–ãƒ»ãƒ­ã‚°ç¢ºèª

### 3. é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿
- **ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼**: å„ãƒ­ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
- **ãƒ†ã‚¹ãƒˆã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ**: èªè¨¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆç”¨ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿
- **æ¨©é™ãƒ†ã‚¹ãƒˆ**: å„ãƒ­ãƒ¼ãƒ«ã§ã®æ©Ÿèƒ½ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèªç”¨ãƒ‡ãƒ¼ã‚¿

## ä»Šå¾Œã®æ‹¡å¼µæ€§

### 1. èªè¨¼æ–¹å¼ã®æ‹¡å¼µ
- **å¤šè¦ç´ èªè¨¼**: SMSãƒ»ãƒ¡ãƒ¼ãƒ«ãƒ»ã‚¢ãƒ—ãƒªèªè¨¼
- **SSOé€£æº**: Active Directoryãƒ»LDAPé€£æº
- **OAuth 2.0**: å¤–éƒ¨èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼é€£æº

### 2. æ¨©é™ç®¡ç†ã®æ‹¡å¼µ
- **ç´°ç²’åº¦æ¨©é™**: æ©Ÿèƒ½ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ¬ãƒ™ãƒ«ã§ã®æ¨©é™ç®¡ç†
- **å‹•çš„æ¨©é™**: æ¥­å‹™çŠ¶æ³ã«å¿œã˜ãŸæ¨©é™å¤‰æ›´
- **æ¨©é™å§”è­²**: ä¸€æ™‚çš„ãªæ¨©é™å§”è­²æ©Ÿèƒ½

### 3. ç›£æŸ»ãƒ»ç›£è¦–ã®æ‹¡å¼µ
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–**: èªè¨¼ãƒ»èªå¯ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
- **ç•°å¸¸æ¤œçŸ¥**: ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è‡ªå‹•æ¤œçŸ¥
- **ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒãƒ¼ãƒˆã®è‡ªå‹•ç”Ÿæˆ

---

**æ–‡æ›¸å±¥æ­´**

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ | å¤‰æ›´è€… |
|------|------------|----------|--------|
| 2025-09-02 | 1.0 | åˆç‰ˆä½œæˆ | ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºãƒãƒ¼ãƒ  |
